<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹æ ¼æ”»é˜²æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fef3c7; /* Amber-100 */
            background-image: radial-gradient(#d97706 1px, transparent 1px);
            background-size: 20px 20px;
            overflow-x: hidden;
        }

        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
        }

        #wheel-canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); /* Ease-out effect */
        }

        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #dc2626; /* Red-600 */
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        /* Modal Animation */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 200ms, transform 200ms;
        }

        .btn-wood {
            background: linear-gradient(to bottom, #a0522d, #8b4513);
            border: 2px solid #5d2e0c;
            box-shadow: 0 4px 0 #5d2e0c;
            transition: all 0.1s;
        }
        .btn-wood:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #5d2e0c;
        }

        .instruction-step {
            display: flex;
            align-items: start;
            margin-bottom: 12px;
            text-align: left;
        }
        .step-num {
            background-color: #d97706;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 2px;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">

    <!-- Header -->
    <header class="text-center py-6 px-4">
        <h1 class="text-3xl font-bold text-amber-900 tracking-wider mb-2">ä¹æ ¼æ”»é˜²æˆ°</h1>
        <p class="text-amber-700 text-sm">é»æ“ŠæŒ‰éˆ•ï¼Œæ±ºå®šä½ çš„æ”»é˜²æ­¦å™¨ï¼</p>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center px-4 pb-10">
        
        <!-- Wheel Section -->
        <div class="wheel-container mb-8">
            <div class="pointer"></div>
            <canvas id="wheel-canvas" width="600" height="600"></canvas>
            <!-- Center Hub -->
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full border-4 border-amber-200 shadow-md z-10 flex items-center justify-center">
                <div class="w-4 h-4 bg-amber-500 rounded-full"></div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center w-full max-w-xs space-y-4">
            <button id="spin-btn" class="btn-wood w-full py-4 text-white text-xl font-bold rounded-xl tracking-widest">
                é–‹å§‹æŠ½æ­¦å™¨ï¼
            </button>

            <!-- Result Area (Hidden initially) -->
            <div id="result-area" class="hidden w-full text-center bg-white/90 backdrop-blur-sm p-4 rounded-xl shadow-lg border-2 border-amber-300">
                <p class="text-gray-500 text-sm mb-1">æ­å–œç²å¾—</p>
                <h2 id="result-name" class="text-2xl font-bold text-red-600 mb-3">æ©¡çš®ç­‹æ§</h2>
                <button id="tutorial-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg font-medium shadow-md w-full transition-colors flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                    </svg>
                    è§€çœ‹è£½ä½œèªªæ˜
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-4 text-amber-800/60 text-xs">
        <p>Â© æ‡·èˆŠç«¥ç©å·¥ä½œå®¤</p>
    </footer>

    <!-- Tutorial Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center px-4 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div id="modal-content" class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden transform scale-90 transition-transform duration-300">
            <!-- Modal Header -->
            <div id="modal-header" class="bg-amber-500 p-4 flex justify-between items-center">
                <h3 id="modal-title" class="text-white text-xl font-bold">è£½ä½œæ•™å­¸</h3>
                <button id="close-modal" class="text-white hover:bg-amber-600 rounded-full p-1 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 max-h-[60vh] overflow-y-auto">
                <div class="flex justify-center mb-6">
                    <div id="modal-icon" class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center text-4xl">
                        ğŸ”«
                    </div>
                </div>
                <div id="modal-steps" class="space-y-2 text-gray-700">
                    <!-- Steps will be injected here -->
                </div>
                
                <div class="mt-6 p-3 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
                    âš ï¸ <strong>å®‰å…¨æ³¨æ„ï¼š</strong> è«‹å‹¿å°æº–äººæˆ–å‹•ç‰©ç™¼å°„ï¼Œåƒ…å¯å°„æ“Šç´™é¶æˆ–ç½é ­å–”ï¼
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 border-t bg-gray-50 text-center">
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700 font-medium text-sm">
                    å›åˆ°è½‰ç›¤
                </button>
            </div>
        </div>
    </div>

    <script>
        // Data Configuration
        const weapons = [
            {
                id: 1,
                name: "æ©¡çš®ç­‹æ§",
                color: "#fca5a5", // Red-300
                textColor: "#7f1d1d",
                icon: "ğŸ”«",
                steps: [
                    "æ‹¿å‡ºéŠæˆ²é™„çš„æœ¨æ§å’Œç´„ 5 æ¢æ©¡çš®ç­‹ã€‚",
                    "å°‡ç«¹ç­·çš„å¤§é ­ç«¯åˆ‡å‡ºä¸€å€‹å‡¹æ§½ï¼ˆç”¨ä¾†å‹¾æ©¡çš®ç­‹ï¼‰ã€‚",
                    "å°‡å¦ä¸€æ ¹ç«¹ç­·åˆ‡çŸ­åšæˆã€Œæ¿æ©Ÿã€èˆ‡ã€Œæ¡æŠŠã€ã€‚",
                    "ä½¿ç”¨æ©¡çš®ç­‹å°‡æ¡æŠŠèˆ‡æ§èº«ä»¥åå­—äº¤å‰æ–¹å¼ç¶ç·Šã€‚",
                    "è£ä¸Šæ¿æ©Ÿï¼Œç”¨æ©¡çš®ç­‹å›ºå®šï¼Œç¢ºä¿å¯ä»¥æ´»å‹•ã€‚",
                    "å°‡ç™¼å°„ç”¨çš„æ©¡çš®ç­‹å‹¾åœ¨å‡¹æ§½èˆ‡æ¿æ©Ÿä¸Šæ–¹å³å®Œæˆï¼"
                ]
            },
            {
                id: 2,
                name: "ç‰™ç·šæ£’å¼“ç®­",
                color: "#93c5fd", // Blue-300
                textColor: "#1e3a8a",
                icon: "ğŸ¹",
                steps: [
                    "æº–å‚™ä¸€æ”¯ç‰™ç·šæ£’ç•¶ä½œã€Œå¼“ã€ï¼Œä¸€æ”¯æ£‰èŠ±æ£’ç•¶ä½œã€Œç®­ã€ã€‚",
                    "ç”¨å‰ªåˆ€å°‡æ£‰èŠ±æ£’çš„ä¸€é ­æ£‰èŠ±å‰ªæ‰ï¼Œä¿®å‰ªå¹³æ•´ã€‚",
                    "æª¢æŸ¥ç‰™ç·šæ£’çš„ç·šæ˜¯å¦ç·Šç¹ƒï¼Œé€™å°±æ˜¯ä½ çš„å¼“å¼¦ã€‚",
                    "å·¦æ‰‹æ‹¿ç‰™ç·šæ£’ï¼Œå°‡æ£‰èŠ±æ£’å°¾ç«¯æŠµåœ¨ç‰™ç·šä¸Šã€‚",
                    "å³æ‰‹æä½æ£‰èŠ±æ£’å°¾ç«¯èˆ‡ç‰™ç·šï¼Œå¾€å¾Œæ‹‰æ»¿å¼“ã€‚",
                    "ç„æº–ç›®æ¨™ï¼Œé¬†é–‹å³æ‰‹æ‰‹æŒ‡å³å¯ç™¼å°„ï¼"
                ]
            },
            {
                id: 3,
                name: "ç“¦æ¥æ¿æ§",
                color: "#86efac", // Green-300
                textColor: "#14532d",
                icon: "âš”ï¸",
                steps: [
                    "æº–å‚™ 3-4 é›™ç«¹ç­·èˆ‡å¤šæ¢æ©¡çš®ç­‹ã€‚",
                    "å°‡å…©é›™ç«¹ç­·ç¶æˆåå­—å½¢ï¼Œæ©«å‘çš„ä½œç‚ºå¼“è‡‚ã€‚",
                    "åœ¨æ©«å‘ç«¹ç­·çš„å·¦å³å…©ç«¯å„ç¶ä¸Šä¸€æ¢æ©¡çš®ç­‹ã€‚",
                    "å°‡é€™å…©æ¢æ©¡çš®ç­‹æ‹‰åˆ°ä¸­é–“ç¶åœ¨ä¸€èµ·ï¼Œå½¢æˆå¼“å¼¦ã€‚",
                    "åœ¨ç›´å‘ç«¹ç­·å¾Œç«¯è£½ä½œä¸€å€‹ç°¡æ˜“å¤¾å­æˆ–æ¿æ©Ÿã€‚",
                    "å°‡å¼“å¼¦æ‹‰å¾Œå‹¾ä½æ¿æ©Ÿï¼Œæ”¾å…¥çŸ­ç«¹ç­·ï¼Œæ‰£æ¿æ©Ÿç™¼å°„ã€‚"
                ]
            },
            {
                id: 4,
                name: "ç°¡æ˜“æŠ•çŸ³æ©Ÿ",
                color: "#fde047", // Yellow-300
                textColor: "#713f12",
                icon: "â˜„ï¸",
                steps: [
                    "æº–å‚™ 7-8 æ ¹å†°æ£’æ£èˆ‡æ©¡çš®ç­‹ã€‚",
                    "å°‡ 5 æ ¹å†°æ£’æ£ç–Šåœ¨ä¸€èµ·ï¼Œå…©ç«¯ç”¨æ©¡çš®ç­‹ç¶ç·Šã€‚",
                    "å¦å¤–æ‹¿ 2 æ ¹å†°æ£’æ£ï¼Œå…¶ä¸­ä¸€ç«¯ç¶ç·Šï¼Œåšæˆé´¨å˜´ç‹€ã€‚",
                    "å°‡ 5 æ ¹ç–Šå¥½çš„å†°æ£’æ£å¡å…¥é´¨å˜´ä¸­é–“æ’é–‹ã€‚",
                    "ç”¨æ©¡çš®ç­‹å°‡äº¤æ¥è™•ç¶æˆåå­—å›ºå®šã€‚",
                    "åœ¨ä¸Šæ–¹å†°æ£’æ£æœ«ç«¯é»ä¸Šä¸€å€‹å¯¶ç‰¹ç“¶è“‹ç•¶ä½œã€Œå‹ºå­ã€ã€‚",
                    "æ”¾å…¥ç´™åœ˜ï¼Œå¾€ä¸‹å£“å‹ºå­å†æ”¾é–‹ï¼Œç™¼å°„ï¼"
                ]
            }
        ];

        // Canvas Setup
        const canvas = document.getElementById('wheel-canvas');
        const ctx = canvas.getContext('2d');
        const size = 600; // Canvas resolution
        const centerX = size / 2;
        const centerY = size / 2;
        const radius = size / 2;
        const arc = (2 * Math.PI) / weapons.length;

        // Draw the Wheel
        function drawWheel() {
            weapons.forEach((weapon, i) => {
                const angle = i * arc;
                
                // Draw Segment
                ctx.beginPath();
                ctx.fillStyle = weapon.color;
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + arc);
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                // Draw Text
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = weapon.textColor;
                ctx.font = "bold 40px 'Noto Sans TC'";
                ctx.fillText(weapon.name, radius - 40, 10);
                
                // Draw Icon
                ctx.font = "40px Arial";
                ctx.fillText(weapon.icon, radius - 260, 12);
                
                ctx.restore();
            });
        }

        drawWheel();

        // Game Logic
        const spinBtn = document.getElementById('spin-btn');
        const wheelCanvas = document.getElementById('wheel-canvas');
        const resultArea = document.getElementById('result-area');
        const resultName = document.getElementById('result-name');
        const tutorialBtn = document.getElementById('tutorial-btn');
        
        // Modal Elements
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const closeModal = document.getElementById('close-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const modalTitle = document.getElementById('modal-title');
        const modalSteps = document.getElementById('modal-steps');
        const modalIcon = document.getElementById('modal-icon');

        let currentRotation = 0;
        let isSpinning = false;
        let currentWinner = null;

        spinBtn.addEventListener('click', () => {
            if (isSpinning) return;

            // Hide previous result
            resultArea.classList.add('hidden');
            isSpinning = true;
            spinBtn.textContent = "æŠ½çä¸­...";
            spinBtn.classList.add('opacity-75');

            // Calculate Random Rotation (minimum 3 spins + random offset)
            const randomDegree = Math.floor(Math.random() * 360);
            const extraSpins = 360 * 5; // 5 full spins
            const totalRotate = currentRotation + extraSpins + randomDegree;
            
            // Ensure we land clearly (add padding logic if needed, but CSS ease handles it visually)
            currentRotation = totalRotate;

            // Apply CSS Transform
            wheelCanvas.style.transform = `rotate(-${currentRotation}deg)`;

            // Wait for animation to finish (4s match CSS)
            setTimeout(() => {
                isSpinning = false;
                spinBtn.textContent = "å†æŠ½ä¸€æ¬¡";
                spinBtn.classList.remove('opacity-75');
                determineWinner(currentRotation);
            }, 4000);
        });

        function determineWinner(rotation) {
            // Normalize rotation to 0-360
            const actualRotation = rotation % 360;
            
            // Calculate which segment is at the top (Pointer is at 270 degrees in CSS logical space? No, pointer is visually top)
            // The logic: 0 degrees is 3 o'clock. Canvas rotates Counter Clockwise usually? No, we rotated negative (CCW).
            // Let's simplify: 
            // If we rotate -90 deg, segment 1 (0-90) moves from 3 o'clock to 12 o'clock.
            // So Pointer (at 12 o'clock / 270 deg / -90 deg) intersects based on rotation.
            
            // Formula to find index:
            // The pointer is static at the top. The wheel rotates.
            // Degree per slice = 360 / 4 = 90.
            
            // Angle of the pointer relative to the wheel's 0 degree mark:
            // (PointerAngle + TotalRotation) % 360
            // Pointer is at 270 degrees (Top) in Canvas coordinates (0 is Right, 90 Down, 180 Left, 270 Top).
            // But we applied `rotate(-degrees)`.
            
            // Let's reverse engineer:
            // Slice 0: 0-90
            // Slice 1: 90-180
            // Slice 2: 180-270
            // Slice 3: 270-360
            
            // The winning angle on the wheel is the one aligning with 270deg (Top).
            // WinnerAngle = (270 + rotation) % 360
            
            let winningAngle = (270 + rotation) % 360;
            const winningIndex = Math.floor(winningAngle / 90);
            
            currentWinner = weapons[winningIndex];
            showResult(currentWinner);
        }

        function showResult(winner) {
            resultName.textContent = winner.name;
            resultArea.classList.remove('hidden');
            // Trigger a small pulse animation via reflow could be added here
        }

        // Modal Logic
        function openModal() {
            if (!currentWinner) return;

            modalTitle.textContent = currentWinner.name + " è£½ä½œæ”»ç•¥";
            modalIcon.textContent = currentWinner.icon;
            
            // Generate Steps HTML
            modalSteps.innerHTML = currentWinner.steps.map((step, index) => `
                <div class="instruction-step">
                    <span class="step-num">${index + 1}</span>
                    <p class="text-sm leading-relaxed">${step}</p>
                </div>
            `).join('');

            // Show Modal
            modalOverlay.classList.remove('hidden');
            // Allow display:block to apply before changing opacity for transition
            requestAnimationFrame(() => {
                modalOverlay.classList.remove('opacity-0');
                modalContent.classList.remove('scale-90');
            });
        }

        function closeModalFunc() {
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.add('scale-90');
            
            setTimeout(() => {
                modalOverlay.classList.add('hidden');
            }, 300); // Match CSS transition time
        }

        tutorialBtn.addEventListener('click', openModal);
        closeModal.addEventListener('click', closeModalFunc);
        closeModalBtn.addEventListener('click', closeModalFunc);
        
        // Close on clicking outside
        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                closeModalFunc();
            }
        });

    </script>
</body>

</html>
